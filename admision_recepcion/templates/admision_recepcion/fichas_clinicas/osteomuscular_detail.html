{% extends 'base_hms.html' %}
{% load static %}

{% block title %}Evaluaci√≥n Osteomuscular - {{ ficha.nombre_trabajador }}{% endblock %}

{% block extra_css %}
<style>
    .osteomuscular-header {
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        color: white;
        padding: 20px;
        border-radius: 15px 15px 0 0;
        margin-bottom: 0;
    }

    .osteo-section {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 25px;
        overflow: hidden;
    }

    .section-header {
        background: linear-gradient(135deg, #f8f9fc 0%, #eef2f7 100%);
        padding: 15px 20px;
        border-bottom: 1px solid #e3e6f0;
        font-weight: 600;
        color: #5a5c69;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .section-content {
        padding: 20px;
    }

    .basic-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .info-field {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 8px;
        border-left: 4px solid #8e44ad;
    }

    .info-field.compact {
        padding: 8px 10px;
    }

    .info-field label {
        font-weight: 600;
        color: #5a5c69;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
        display: block;
    }

    .info-field input,
    .info-field select,
    .info-field textarea {
        border: none;
        background: transparent;
        font-weight: 500;
        color: #2c3e50;
        width: 100%;
        padding: 5px 0;
        font-size: 0.9rem;
    }

    .tab-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 25px;
        overflow: hidden;
    }

    .tab-headers {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid #e3e6f0;
    }

    .tab-header {
        flex: 1;
        padding: 15px 20px;
        text-align: center;
        cursor: pointer;
        font-weight: 600;
        color: #5a5c69;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
    }

    .tab-header.active {
        background: white;
        color: #8e44ad;
        border-bottom-color: #8e44ad;
    }

    .tab-content {
        padding: 20px;
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* Diagrama anat√≥mico */
    .anatomical-diagram {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        text-align: center;
    }

    .anatomy-views {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .anatomy-view {
        background: white;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: relative;
        min-height: 300px;
        border: 2px solid #e3e6f0;
        transition: all 0.3s ease;
    }

    .anatomy-view:hover {
        border-color: #8e44ad;
        transform: translateY(-2px);
    }

    .anatomy-view h6 {
        color: #8e44ad;
        font-weight: 600;
        margin-bottom: 15px;
        text-align: center;
    }

    .anatomy-figure {
        width: 100%;
        height: 250px;
        background: #f1f3f4;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
    }

    .anatomy-figure svg {
        width: 80%;
        height: 80%;
    }

    .measurement-tools {
        background: #e8f4fd;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
    }

    .measurement-table {
        width: 100%;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 15px;
    }

    .measurement-table th {
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        color: white;
        padding: 12px;
        text-align: center;
        font-weight: 600;
    }

    .measurement-table td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #e3e6f0;
    }

    .measurement-table input {
        border: 1px solid #e3e6f0;
        border-radius: 4px;
        padding: 6px 8px;
        width: 80px;
        text-align: center;
    }

    /* Flexibilidad con diagramas */
    .flexibility-section {
        background: #fff3cd;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
    }

    .flexibility-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .flexibility-item {
        background: white;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .flexibility-diagram {
        width: 100%;
        height: 120px;
        background: #f8f9fa;
        border-radius: 8px;
        margin: 10px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #8e44ad;
    }

    .flexibility-controls {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 10px 0;
    }

    .flex-btn {
        padding: 6px 12px;
        border: 1px solid #8e44ad;
        background: white;
        color: #8e44ad;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .flex-btn.active {
        background: #8e44ad;
        color: white;
    }

    .flex-btn.leve.active {
        background: #28a745;
        border-color: #28a745;
    }

    .flex-btn.moderado.active {
        background: #ffc107;
        border-color: #ffc107;
        color: #000;
    }

    .flex-btn.severo.active {
        background: #dc3545;
        border-color: #dc3545;
    }

    /* Pruebas semiol√≥gicas */
    .semiological-tests {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
    }

    .tests-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
    }

    .tests-table th {
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        color: white;
        padding: 12px;
        text-align: center;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .tests-table td {
        padding: 10px;
        border-bottom: 1px solid #e3e6f0;
        text-align: center;
        vertical-align: middle;
    }

    .tests-table .test-name {
        background: #f8f9fa;
        font-weight: 600;
        color: #5a5c69;
        text-align: left;
        padding-left: 15px;
    }

    .test-result-group {
        display: flex;
        justify-content: center;
        gap: 5px;
    }

    .test-btn {
        padding: 5px 10px;
        border: 1px solid #e3e6f0;
        background: white;
        color: #5a5c69;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .test-btn.normal.active {
        background: #28a745;
        color: white;
        border-color: #28a745;
    }

    .test-btn.positivo.active {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
    }

    .test-btn.negativo.active {
        background: #17a2b8;
        color: white;
        border-color: #17a2b8;
    }

    .test-btn.alterado.active {
        background: #ffc107;
        color: #000;
        border-color: #ffc107;
    }

    /* An√°lisis de marcha */
    .gait-analysis {
        background: #e8f4fd;
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
    }

    .phase-section {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
    }

    .phase-header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 10px 15px;
        border-radius: 6px;
        margin-bottom: 15px;
        font-weight: 600;
        text-align: center;
    }

    .gait-table {
        width: 100%;
        border-collapse: collapse;
    }

    .gait-table th {
        background: #f8f9fa;
        padding: 10px;
        border: 1px solid #e3e6f0;
        text-align: center;
        font-weight: 600;
        color: #5a5c69;
    }

    .gait-table td {
        padding: 8px;
        border: 1px solid #e3e6f0;
        text-align: center;
    }

    .gait-table .phase-name {
        background: #f8f9fa;
        font-weight: 600;
        text-align: left;
        padding-left: 15px;
    }

    .worker-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        font-weight: bold;
        margin-right: 20px;
    }

    .header-info {
        display: flex;
        align-items: center;
    }

    .worker-details h3 {
        margin: 0;
        font-size: 1.5rem;
    }

    .worker-details p {
        margin: 5px 0 0 0;
        opacity: 0.9;
    }

    .instructivo-alert {
        background: #e3f2fd;
        border: 1px solid #90caf9;
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
    }

    .instructivo-alert i {
        color: #1976d2;
        margin-right: 10px;
    }

    .instructivo-alert a {
        color: #1976d2;
        text-decoration: none;
        font-weight: 500;
    }

    .observations-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        margin: 20px 0;
    }

    .observations-section textarea {
        width: 100%;
        min-height: 120px;
        border: 1px solid #e3e6f0;
        border-radius: 8px;
        padding: 15px;
        font-family: inherit;
        resize: vertical;
    }

    .save-section {
        position: sticky;
        bottom: 0;
        background: white;
        padding: 20px;
        border-top: 1px solid #e3e6f0;
        text-align: center;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }

    .btn-save {
        background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        border: none;
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
        transition: all 0.3s ease;
    }

    .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(142, 68, 173, 0.4);
    }

    .auto-calculation {
        background: #d4edda;
        padding: 10px;
        border-radius: 6px;
        margin: 10px 0;
        text-align: center;
        font-weight: 600;
        color: #155724;
    }

    .calculation-badge {
        display: inline-block;
        background: #8e44ad;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        margin-left: 5px;
    }
</style>
{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Inicio</a></li>
        <li class="breadcrumb-item"><a href="{% url 'admision_recepcion:dashboard' %}">Admisi√≥n - Recepci√≥n</a></li>
        <li class="breadcrumb-item"><a href="{% url 'admision_recepcion:fichas_clinicas' %}">Fichas Cl√≠nicas</a></li>
        <li class="breadcrumb-item active" aria-current="page">Evaluaci√≥n Osteomuscular</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header de evaluaci√≥n osteomuscular -->
    <div class="osteomuscular-header">
        <div class="header-info">
            <div class="worker-avatar">
                ü¶¥
            </div>
            <div class="worker-details">
                <h3>Evaluaci√≥n Osteomuscular - {{ ficha.nombre_trabajador }}</h3>
                <p><strong>Ficha N¬∞:</strong> {{ ficha.numero_ficha }} | <strong>Identificaci√≥n:</strong> {{
                    ficha.numero_identificacion }}</p>
                <p><strong>Empresa:</strong> {% if ficha.empresa %}{{ ficha.empresa.razon_social }}{% else %}No
                    especificada{% endif %}</p>
            </div>
        </div>
    </div>

    <!-- Instructivo -->
    <div class="instructivo-alert">
        <i class="fas fa-info-circle"></i>
        <span>üëâüèº <a href="#" onclick="alert('Instructivo de Evaluaci√≥n Osteomuscular - En desarrollo')">De clic aqu√≠
                para aprender o ver los instructivos</a></span>
    </div>

    <form method="post" id="osteomuscularForm">
        {% csrf_token %}

        <!-- Informaci√≥n B√°sica -->
        <div class="osteo-section">
            <div class="section-header">
                <span>ü¶¥ Informaci√≥n B√°sica de la Evaluaci√≥n</span>
            </div>
            <div class="section-content">
                <div class="basic-info-grid">
                    <div class="info-field">
                        <label>Producto:</label>
                        <input type="text" name="producto" value="{{ evaluacion.producto|default:'' }}">
                    </div>
                    <div class="info-field">
                        <label>Municipio:</label>
                        <input type="text" value="EL BANCO (MAGDALENA, COLOMBIA)" readonly>
                    </div>
                    <div class="info-field">
                        <label>Fecha:</label>
                        <input type="date" name="fecha_evaluacion" value="{{ ficha.fecha_evaluacion|date:'Y-m-d' }}"
                            required>
                    </div>
                    <div class="info-field">
                        <label>Tipo Evaluaci√≥n M√©dica:</label>
                        <select name="tipo_evaluacion_medica">
                            <option value="PREOCUPACIONAL">Pre-ocupacional</option>
                            <option value="OCUPACIONAL">Ocupacional</option>
                            <option value="POSTOCUPACIONAL">Post-ocupacional</option>
                        </select>
                    </div>
                    <div class="info-field">
                        <label>Empresa:</label>
                        <select name="empresa">
                            <option value="">Seleccione</option>
                            {% for empresa in empresas %}
                            <option value="{{ empresa.id }}" {% if ficha.empresa_id==empresa.id %}selected{% endif %}>
                                {{ empresa.razon_social }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="info-field">
                        <label>Tipo:</label>
                        <select name="tipo_documento">
                            {% for codigo, nombre in ficha.TIPO_DOC_CHOICES %}
                            <option value="{{ codigo }}" {% if ficha.tipo_documento==codigo %}selected{% endif %}>{{
                                nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="info-field">
                        <label>N¬∞ de Identificaci√≥n:</label>
                        <input type="text" name="numero_identificacion" value="{{ ficha.numero_identificacion }}"
                            required>
                    </div>
                    <div class="info-field">
                        <label>Nombre:</label>
                        <input type="text" name="nombre_trabajador" value="{{ ficha.nombre_trabajador }}" required>
                    </div>
                    <div class="info-field compact">
                        <label>Edad:</label>
                        <input type="number" name="edad" value="{{ ficha.edad }}" min="16" max="100">
                    </div>
                    <div class="info-field compact">
                        <label>Peso (kg):</label>
                        <input type="number" step="0.01" name="peso_kg" value="{{ evaluacion.peso_kg|default:'' }}"
                            onchange="calcularIMC()">
                    </div>
                    <div class="info-field compact">
                        <label>Talla (cm):</label>
                        <input type="number" step="0.01" name="talla_cm" value="{{ evaluacion.talla_cm|default:'' }}"
                            onchange="calcularIMC()">
                    </div>
                    <div class="info-field compact">
                        <label>IMC:</label>
                        <input type="number" step="0.01" name="imc" id="imc_field"
                            value="{{ evaluacion.imc|default:'' }}" readonly>
                        {% if imc_calculado %}<span class="calculation-badge">{{ imc_calculado }}</span>{% endif %}
                    </div>
                    <div class="info-field">
                        <label>Cargo:</label>
                        <input type="text" name="cargo" value="{{ ficha.cargo }}">
                    </div>
                    <div class="info-field">
                        <label>Funciones del Cargo:</label>
                        <textarea name="funciones_cargo" rows="3">{{ evaluacion.funciones_cargo|default:'' }}</textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sistema de Tabs -->
        <div class="tab-container">
            <div class="tab-headers">
                <div class="tab-header active" onclick="showTab('evaluacion_postural')">Evaluaci√≥n Postural</div>
                <div class="tab-header" onclick="showTab('movilidad_articular')">Movilidad Articular</div>
                <div class="tab-header" onclick="showTab('pruebas')">Pruebas</div>
            </div>

            <!-- Tab de Evaluaci√≥n Postural -->
            <div id="evaluacion_postural" class="tab-content active">
                <div class="anatomical-diagram">
                    <h5>Evaluaci√≥n Postural</h5>
                    <p class="text-muted">Seleccione las alteraciones posturales en las diferentes vistas anat√≥micas</p>

                    <div class="anatomy-views">
                        <!-- Vista Anterior -->
                        <div class="anatomy-view">
                            <h6>Vista Anterior</h6>
                            <div class="anatomy-figure">
                                <svg viewBox="0 0 200 400">
                                    <!-- Figura humana anterior simplificada -->
                                    <ellipse cx="100" cy="40" rx="20" ry="25" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="85" y="65" width="30" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="90" y="145" width="20" height="100" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="70" y="70" width="15" height="60" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="115" y="70" width="15" height="60" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="85" y="245" width="10" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="105" y="245" width="10" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <text x="100" y="360" text-anchor="middle" font-size="12"
                                        fill="#666">Anterior</text>
                                </svg>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="cabeza_anterior" name="postura_anterior_cabeza">
                                <label for="cabeza_anterior">Alteraci√≥n cabeza</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="hombros_anterior" name="postura_anterior_hombros">
                                <label for="hombros_anterior">Desnivel hombros</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="torax_anterior" name="postura_anterior_torax">
                                <label for="torax_anterior">Alteraci√≥n t√≥rax</label>
                            </div>
                        </div>

                        <!-- Vista Posterior -->
                        <div class="anatomy-view">
                            <h6>Vista Posterior</h6>
                            <div class="anatomy-figure">
                                <svg viewBox="0 0 200 400">
                                    <!-- Figura humana posterior simplificada -->
                                    <ellipse cx="100" cy="40" rx="20" ry="25" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="85" y="65" width="30" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <line x1="100" y1="65" x2="100" y2="145" stroke="#8e44ad" stroke-width="3" />
                                    <rect x="90" y="145" width="20" height="100" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="70" y="70" width="15" height="60" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="115" y="70" width="15" height="60" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="85" y="245" width="10" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="105" y="245" width="10" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <text x="100" y="360" text-anchor="middle" font-size="12"
                                        fill="#666">Posterior</text>
                                </svg>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="escoliosis" name="postura_posterior_escoliosis">
                                <label for="escoliosis">Escoliosis</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="escapulas" name="postura_posterior_escapulas">
                                <label for="escapulas">Alteraci√≥n esc√°pulas</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="pelvis_post" name="postura_posterior_pelvis">
                                <label for="pelvis_post">Desnivel p√©lvico</label>
                            </div>
                        </div>

                        <!-- Vista Lateral Izquierda -->
                        <div class="anatomy-view">
                            <h6>Vista Lateral Izquierda</h6>
                            <div class="anatomy-figure">
                                <svg viewBox="0 0 200 400">
                                    <!-- Figura humana lateral izquierda -->
                                    <ellipse cx="100" cy="40" rx="15" ry="25" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <path d="M 100 65 Q 110 100 100 145" fill="none" stroke="#8e44ad"
                                        stroke-width="3" />
                                    <rect x="90" y="65" width="20" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="95" y="145" width="15" height="100" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="105" y="75" width="12" height="55" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="98" y="245" width="8" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <text x="100" y="360" text-anchor="middle" font-size="12" fill="#666">Lateral
                                        Izq</text>
                                </svg>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="cervical_izq" name="postura_lateral_izq_cervical">
                                <label for="cervical_izq">Hiperlordosis cervical</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="dorsal_izq" name="postura_lateral_izq_dorsal">
                                <label for="dorsal_izq">Hipercifosis dorsal</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="lumbar_izq" name="postura_lateral_izq_lumbar">
                                <label for="lumbar_izq">Hiperlordosis lumbar</label>
                            </div>
                        </div>

                        <!-- Vista Lateral Derecha -->
                        <div class="anatomy-view">
                            <h6>Vista Lateral Derecha</h6>
                            <div class="anatomy-figure">
                                <svg viewBox="0 0 200 400">
                                    <!-- Figura humana lateral derecha -->
                                    <ellipse cx="100" cy="40" rx="15" ry="25" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <path d="M 100 65 Q 90 100 100 145" fill="none" stroke="#8e44ad" stroke-width="3" />
                                    <rect x="90" y="65" width="20" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="95" y="145" width="15" height="100" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="83" y="75" width="12" height="55" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <rect x="98" y="245" width="8" height="80" fill="#f0f0f0" stroke="#666"
                                        stroke-width="2" />
                                    <text x="100" y="360" text-anchor="middle" font-size="12" fill="#666">Lateral
                                        Der</text>
                                </svg>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="cervical_der" name="postura_lateral_der_cervical">
                                <label for="cervical_der">Hiperlordosis cervical</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="dorsal_der" name="postura_lateral_der_dorsal">
                                <label for="dorsal_der">Hipercifosis dorsal</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="lumbar_der" name="postura_lateral_der_lumbar">
                                <label for="lumbar_der">Hiperlordosis lumbar</label>
                            </div>
                        </div>
                    </div>

                    {% if alteraciones_posturales %}
                    <div class="auto-calculation">
                        <strong>Alteraciones Posturales Detectadas:</strong>
                        <span class="calculation-badge">{{ alteraciones_posturales }} alteraciones</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Tab de Movilidad Articular -->
            <div id="movilidad_articular" class="tab-content">
                <!-- Medidas de Longitud -->
                <div class="measurement-tools">
                    <h6>Medidas de Longitud</h6>
                    <table class="measurement-table">
                        <thead>
                            <tr>
                                <th>MID</th>
                                <th>MIT</th>
                                <th>MSD</th>
                                <th>MST</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="measurement-table-header">Longitud Real</td>
                                <td><input type="number" step="0.1" name="longitud_real_mid"></td>
                                <td><input type="number" step="0.1" name="longitud_real_mit"></td>
                                <td><input type="number" step="0.1" name="longitud_real_msd"></td>
                                <td><input type="number" step="0.1" name="longitud_real_mst"></td>
                            </tr>
                            <tr>
                                <td class="measurement-table-header">Longitud Aparente</td>
                                <td><input type="number" step="0.1" name="longitud_aparente_mid"></td>
                                <td><input type="number" step="0.1" name="longitud_aparente_mit"></td>
                                <td><input type="number" step="0.1" name="longitud_aparente_msd"></td>
                                <td><input type="number" step="0.1" name="longitud_aparente_mst"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Flexibilidad con diagramas -->
                <div class="flexibility-section">
                    <h6>Medidas de Flexibilidad</h6>
                    <div class="flexibility-grid">
                        <!-- Extensibilidad -->
                        <div class="flexibility-item">
                            <h6>EXTENSIBILIDAD</h6>
                            <div class="flexibility-diagram">ü§∏‚Äç‚ôÇÔ∏è</div>
                            <div class="flexibility-controls">
                                <button type="button" class="flex-btn leve"
                                    onclick="setFlexibilidad('extensibilidad', 'LEVE')">LEVE</button>
                                <button type="button" class="flex-btn moderado"
                                    onclick="setFlexibilidad('extensibilidad', 'MODERADO')">MODERADO</button>
                                <button type="button" class="flex-btn severo"
                                    onclick="setFlexibilidad('extensibilidad', 'SEVERO')">SEVERO</button>
                            </div>
                            <input type="hidden" name="extensibilidad" id="extensibilidad"
                                value="{{ evaluacion.extensibilidad }}">
                        </div>

                        <!-- Flexibilidad de Columna -->
                        <div class="flexibility-item">
                            <h6>FLEXIBILIDAD DE COLUMNA</h6>
                            <div class="flexibility-diagram">ü§∏‚Äç‚ôÄÔ∏è</div>
                            <div class="flexibility-controls">
                                <button type="button" class="flex-btn leve"
                                    onclick="setFlexibilidad('flexibilidad_columna', 'LEVE')">LEVE</button>
                                <button type="button" class="flex-btn moderado"
                                    onclick="setFlexibilidad('flexibilidad_columna', 'MODERADO')">MODERADO</button>
                                <button type="button" class="flex-btn severo"
                                    onclick="setFlexibilidad('flexibilidad_columna', 'SEVERO')">SEVERO</button>
                            </div>
                            <input type="hidden" name="flexibilidad_columna" id="flexibilidad_columna"
                                value="{{ evaluacion.flexibilidad_columna }}">
                        </div>

                        <!-- Flexibilidad de Hombros -->
                        <div class="flexibility-item">
                            <h6>FLEXIBILIDAD DE HOMBROS</h6>
                            <div class="flexibility-diagram">üí™</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label>Izq</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('flexibilidad_hombros_izq', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('flexibilidad_hombros_izq', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('flexibilidad_hombros_izq', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="flexibilidad_hombros_izq" id="flexibilidad_hombros_izq"
                                        value="{{ evaluacion.flexibilidad_hombros_izq }}">
                                </div>
                                <div>
                                    <label>Der</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('flexibilidad_hombros_der', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('flexibilidad_hombros_der', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('flexibilidad_hombros_der', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="flexibilidad_hombros_der" id="flexibilidad_hombros_der"
                                        value="{{ evaluacion.flexibilidad_hombros_der }}">
                                </div>
                            </div>
                        </div>

                        <!-- Aductores -->
                        <div class="flexibility-item">
                            <h6>ADUCTORES</h6>
                            <div class="flexibility-diagram">ü¶µ</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label>Izq</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('aductores_izq', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('aductores_izq', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('aductores_izq', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="aductores_izq" id="aductores_izq"
                                        value="{{ evaluacion.aductores_izq }}">
                                </div>
                                <div>
                                    <label>Der</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('aductores_der', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('aductores_der', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('aductores_der', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="aductores_der" id="aductores_der"
                                        value="{{ evaluacion.aductores_der }}">
                                </div>
                            </div>
                        </div>

                        <!-- Gastrocnemios -->
                        <div class="flexibility-item">
                            <h6>GASTROCNEMIOS</h6>
                            <div class="flexibility-diagram">ü¶µ</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label>Izq</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('gastrocnemios_izq', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('gastrocnemios_izq', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('gastrocnemios_izq', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="gastrocnemios_izq" id="gastrocnemios_izq"
                                        value="{{ evaluacion.gastrocnemios_izq }}">
                                </div>
                                <div>
                                    <label>Der</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('gastrocnemios_der', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('gastrocnemios_der', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('gastrocnemios_der', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="gastrocnemios_der" id="gastrocnemios_der"
                                        value="{{ evaluacion.gastrocnemios_der }}">
                                </div>
                            </div>
                        </div>

                        <!-- Isquiotibiales -->
                        <div class="flexibility-item">
                            <h6>ISQUIOTIBIALES</h6>
                            <div class="flexibility-diagram">ü¶µ</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label>Izq</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('isquiotibiales_izq', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('isquiotibiales_izq', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('isquiotibiales_izq', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="isquiotibiales_izq" id="isquiotibiales_izq"
                                        value="{{ evaluacion.isquiotibiales_izq }}">
                                </div>
                                <div>
                                    <label>Der</label>
                                    <div class="flexibility-controls">
                                        <button type="button" class="flex-btn leve"
                                            onclick="setFlexibilidad('isquiotibiales_der', 'LEVE')">LEVE</button>
                                        <button type="button" class="flex-btn moderado"
                                            onclick="setFlexibilidad('isquiotibiales_der', 'MODERADO')">MOD</button>
                                        <button type="button" class="flex-btn severo"
                                            onclick="setFlexibilidad('isquiotibiales_der', 'SEVERO')">SEV</button>
                                    </div>
                                    <input type="hidden" name="isquiotibiales_der" id="isquiotibiales_der"
                                        value="{{ evaluacion.isquiotibiales_der }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    {% if resumen_flexibilidad %}
                    <div class="auto-calculation">
                        <strong>Alteraciones de Flexibilidad:</strong>
                        {% for alteracion in resumen_flexibilidad %}
                        <span class="calculation-badge">{{ alteracion }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Tab de Pruebas -->
            <div id="pruebas" class="tab-content">
                <!-- Pruebas de Flexibilidad Semiol√≥gicas -->
                <div class="semiological-tests">
                    <h5>Pruebas de Flexibilidad</h5>
                    <table class="tests-table">
                        <thead>
                            <tr>
                                <th style="width: 30%;">SEMIOL√ìGICAS</th>
                                <th style="width: 35%;">Izquierda</th>
                                <th style="width: 35%;">Derecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="test-name">BOSTEZO MEDIAL</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('bostezo_medial_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('bostezo_medial_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('bostezo_medial_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="bostezo_medial_izq" id="bostezo_medial_izq"
                                        value="{{ evaluacion.bostezo_medial_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('bostezo_medial_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('bostezo_medial_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('bostezo_medial_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="bostezo_medial_der" id="bostezo_medial_der"
                                        value="{{ evaluacion.bostezo_medial_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">BOSTEZO LATERAL</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('bostezo_lateral_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('bostezo_lateral_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('bostezo_lateral_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="bostezo_lateral_izq" id="bostezo_lateral_izq"
                                        value="{{ evaluacion.bostezo_lateral_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('bostezo_lateral_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('bostezo_lateral_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('bostezo_lateral_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="bostezo_lateral_der" id="bostezo_lateral_der"
                                        value="{{ evaluacion.bostezo_lateral_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">CAJ√ìN ANTERIOR</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('cajon_anterior_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('cajon_anterior_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('cajon_anterior_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="cajon_anterior_izq" id="cajon_anterior_izq"
                                        value="{{ evaluacion.cajon_anterior_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('cajon_anterior_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('cajon_anterior_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('cajon_anterior_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="cajon_anterior_der" id="cajon_anterior_der"
                                        value="{{ evaluacion.cajon_anterior_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">CAJ√ìN POSTERIOR</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('cajon_posterior_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('cajon_posterior_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('cajon_posterior_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="cajon_posterior_izq" id="cajon_posterior_izq"
                                        value="{{ evaluacion.cajon_posterior_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('cajon_posterior_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('cajon_posterior_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('cajon_posterior_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="cajon_posterior_der" id="cajon_posterior_der"
                                        value="{{ evaluacion.cajon_posterior_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">THOMAS</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('thomas_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('thomas_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('thomas_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="thomas_izq" id="thomas_izq"
                                        value="{{ evaluacion.thomas_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('thomas_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('thomas_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('thomas_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="thomas_der" id="thomas_der"
                                        value="{{ evaluacion.thomas_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">OBER</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('ober_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('ober_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('ober_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="ober_izq" id="ober_izq"
                                        value="{{ evaluacion.ober_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('ober_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('ober_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('ober_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="ober_der" id="ober_der"
                                        value="{{ evaluacion.ober_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">ELY</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('ely_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('ely_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('ely_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="ely_izq" id="ely_izq" value="{{ evaluacion.ely_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('ely_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('ely_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('ely_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="ely_der" id="ely_der" value="{{ evaluacion.ely_der }}">
                                </td>
                            </tr>
                            <tr>
                                <td class="test-name">LAS√âGUE</td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('lasegue_izq', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('lasegue_izq', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('lasegue_izq', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="lasegue_izq" id="lasegue_izq"
                                        value="{{ evaluacion.lasegue_izq }}">
                                </td>
                                <td>
                                    <div class="test-result-group">
                                        <button type="button" class="test-btn normal"
                                            onclick="setPrueba('lasegue_der', 'NORMAL')">NORMAL</button>
                                        <button type="button" class="test-btn positivo"
                                            onclick="setPrueba('lasegue_der', 'POSITIVO')">POSITIVO</button>
                                        <button type="button" class="test-btn negativo"
                                            onclick="setPrueba('lasegue_der', 'NEGATIVO')">NEGATIVO</button>
                                    </div>
                                    <input type="hidden" name="lasegue_der" id="lasegue_der"
                                        value="{{ evaluacion.lasegue_der }}">
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    {% if pruebas_positivas %}
                    <div class="auto-calculation">
                        <strong>Pruebas Positivas:</strong>
                        {% for prueba in pruebas_positivas %}
                        <span class="calculation-badge">{{ prueba }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- An√°lisis de Marcha -->
                <div class="gait-analysis">
                    <h5>An√°lisis de Marcha</h5>

                    <!-- Fase de Apoyo -->
                    <div class="phase-section">
                        <div class="phase-header">FASE APOYO</div>
                        <table class="gait-table">
                            <thead>
                                <tr>
                                    <th style="width: 40%;">Fase</th>
                                    <th style="width: 30%;">Izquierda</th>
                                    <th style="width: 30%;">Derecha</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="phase-name">CHOQUE DE TAL√ìN</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('choque_talon_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('choque_talon_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="choque_talon_izq" id="choque_talon_izq"
                                            value="{{ evaluacion.choque_talon_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('choque_talon_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('choque_talon_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="choque_talon_der" id="choque_talon_der"
                                            value="{{ evaluacion.choque_talon_der }}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="phase-name">APOYO PLANTAR</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('apoyo_plantar_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('apoyo_plantar_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="apoyo_plantar_izq" id="apoyo_plantar_izq"
                                            value="{{ evaluacion.apoyo_plantar_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('apoyo_plantar_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('apoyo_plantar_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="apoyo_plantar_der" id="apoyo_plantar_der"
                                            value="{{ evaluacion.apoyo_plantar_der }}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="phase-name">APOYO MEDIO</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('apoyo_medio_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('apoyo_medio_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="apoyo_medio_izq" id="apoyo_medio_izq"
                                            value="{{ evaluacion.apoyo_medio_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('apoyo_medio_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('apoyo_medio_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="apoyo_medio_der" id="apoyo_medio_der"
                                            value="{{ evaluacion.apoyo_medio_der }}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="phase-name">EMPUJE</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('empuje_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('empuje_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="empuje_izq" id="empuje_izq"
                                            value="{{ evaluacion.empuje_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('empuje_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('empuje_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="empuje_der" id="empuje_der"
                                            value="{{ evaluacion.empuje_der }}">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Fase de Balanceo -->
                    <div class="phase-section">
                        <div class="phase-header">FASE BALANCEO</div>
                        <table class="gait-table">
                            <thead>
                                <tr>
                                    <th style="width: 40%;">Fase</th>
                                    <th style="width: 30%;">Izquierda</th>
                                    <th style="width: 30%;">Derecha</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="phase-name">ACELERACI√ìN</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('aceleracion_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('aceleracion_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="aceleracion_izq" id="aceleracion_izq"
                                            value="{{ evaluacion.aceleracion_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('aceleracion_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('aceleracion_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="aceleracion_der" id="aceleracion_der"
                                            value="{{ evaluacion.aceleracion_der }}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="phase-name">BALANCEO MEDIO</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('balanceo_medio_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('balanceo_medio_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="balanceo_medio_izq" id="balanceo_medio_izq"
                                            value="{{ evaluacion.balanceo_medio_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('balanceo_medio_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('balanceo_medio_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="balanceo_medio_der" id="balanceo_medio_der"
                                            value="{{ evaluacion.balanceo_medio_der }}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="phase-name">DESACELERACI√ìN</td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('desaceleracion_izq', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('desaceleracion_izq', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="desaceleracion_izq" id="desaceleracion_izq"
                                            value="{{ evaluacion.desaceleracion_izq }}">
                                    </td>
                                    <td>
                                        <div class="test-result-group">
                                            <button type="button" class="test-btn normal"
                                                onclick="setPrueba('desaceleracion_der', 'NORMAL')">NORMAL</button>
                                            <button type="button" class="test-btn alterado"
                                                onclick="setPrueba('desaceleracion_der', 'ALTERADA')">ALTERADA</button>
                                        </div>
                                        <input type="hidden" name="desaceleracion_der" id="desaceleracion_der"
                                            value="{{ evaluacion.desaceleracion_der }}">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    {% if alteraciones_marcha %}
                    <div class="auto-calculation">
                        <strong>Alteraciones de Marcha:</strong>
                        {% for alteracion in alteraciones_marcha %}
                        <span class="calculation-badge">{{ alteracion }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Observaciones y Recomendaciones -->
        <div class="observations-section">
            <h5>Observaciones y Recomendaciones</h5>
            <textarea name="observaciones"
                placeholder="Escribir observaciones, recomendaciones y plan de tratamiento...">{{ evaluacion.observaciones|default:'' }}</textarea>
        </div>
    </form>

    <!-- Bot√≥n de guardar -->
    <div class="save-section">
        <button type="submit" form="osteomuscularForm" class="btn-save">
            <i class="fas fa-save me-2"></i>Guardar Evaluaci√≥n Osteomuscular
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function showTab(tabName) {
        // Ocultar todos los tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        // Desactivar todos los headers
        document.querySelectorAll('.tab-header').forEach(header => {
            header.classList.remove('active');
        });

        // Mostrar el tab seleccionado
        document.getElementById(tabName).classList.add('active');

        // Activar el header correspondiente
        event.target.classList.add('active');
    }

    function calcularIMC() {
        const peso = parseFloat(document.querySelector('input[name="peso_kg"]').value);
        const talla = parseFloat(document.querySelector('input[name="talla_cm"]').value);

        if (peso && talla) {
            const tallam = talla / 100;
            const imc = peso / (tallam * tallam);
            document.getElementById('imc_field').value = imc.toFixed(2);
        }
    }

    function setFlexibilidad(campo, valor) {
        document.getElementById(campo).value = valor;
        // Actualizar botones
        const buttons = event.target.parentElement.querySelectorAll('.flex-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }

    function setPrueba(campo, valor) {
        document.getElementById(campo).value = valor;
        // Actualizar botones
        const buttons = event.target.parentElement.querySelectorAll('.test-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }

    // Funci√≥n para enviar el formulario
    document.getElementById('osteomuscularForm').addEventListener('submit', function (e) {
        e.preventDefault();
        // Implementar guardado AJAX
        alert('Guardando evaluaci√≥n osteomuscular... (En desarrollo)');
    });

    // Inicializar
    document.addEventListener('DOMContentLoaded', function () {
        console.log('Evaluaci√≥n Osteomuscular cargada correctamente');

        // Auto-calcular IMC si hay datos
        calcularIMC();
    });
</script>
